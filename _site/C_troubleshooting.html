<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>SPECFEM3D_Cartesian</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/assets/css/style.css?v=e01eaeac25bebaede87fee4bc75f9f27dc55c330">
  </head>
  <body>
    <section class="page-header">
      <div class="parallax"><!-- parallax -->
        <div class="parallax_layer parallax_layer_back">
          <div class="img_background img1"></div>
        </div>
      <!-- </div> -->
      <div class="parallax_layer parallax_layer_front">
        <h1 class="project-name">SPECFEM3D_Cartesian</h1>
        <h2 class="project-tagline">SPECFEM3D_Cartesian simulates acoustic (fluid), elastic (solid), coupled acoustic/elastic, poroelastic or seismic wave propagation in any type of conforming mesh of hexahedra (structured or not.)
</h2>
        
          <a href="http://github.com/danielpeter/specfem3d" class="btn">View on GitHub</a>
        
        
      </div><!-- end of parallax -->
    </section>

    <section class="main-content">
      <p><strong>Table of Contents</strong></p>

<ul>
  <li><a href="#troubleshooting">Troubleshooting</a>
    <ul>
      <li><a href="#faq">FAQ</a></li>
    </ul>
  </li>
</ul>

<h1 id="troubleshooting">Troubleshooting</h1>

<h2 id="faq">FAQ</h2>

<p><span>configuration fails:</span><br />
Examine the log file ’config.log’. It contains detailed informations. In many cases, the paths to these specific compiler commands F90, CC and MPIF90 will not be correct if `./configure` fails.</p>

<p>Please make sure that you have a working installation of a Fortran compiler, a C compiler and an MPI implementation. You should be able to compile this little program code:</p>

<div class="highlighter-rouge"><pre class="highlight"><code> program main
 include 'mpif.h'
 integer, parameter :: CUSTOM_MPI_TYPE = MPI_REAL
 integer ier
 call MPI_INIT(ier)
 call MPI_BARRIER(MPI_COMM_WORLD,ier)
 call MPI_FINALIZE(ier)
 end
</code></pre>
</div>

<p><span>compilation fails stating:</span><br />
    …
     obj/program_generate_databases.o: In function <code class="highlighter-rouge">MAIN__':
     program_generate_databases.f90:(.text+0x14): undefined reference to </code>_gfortran_set_std’
    …</p>

<p>Make sure you’re pointing to the right ’mpif90’ wrapper command.</p>

<p>Normally, this message will appear when you are mixing two different Fortran compilers. That is, using e.g. gfortran to compile non-MPI files and mpif90, wrapper provided for e.g. ifort, to compile MPI-files.</p>

<p>fix: e.g. specify &gt; ./configure FC=gfortran MPIF90=/usr/local/openmpi-gfortran/bin/mpif90</p>

<p><span>after executing <code class="highlighter-rouge">xmeshfem3D</code> I’ve got elements with skewness of 81% percent, what does this mean:</span><br />
Look at the skewness table printed in the <code class="highlighter-rouge">output_mesher.txt</code> file after executing <code class="highlighter-rouge">xmeshfem3D</code> for the example given in <code class="highlighter-rouge">EXAMPLES/meshfem3D_examples/simple_model/</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>...
 histogram of skewness (0. good - 1. bad):
 0.0000000E+00 - 5.0000001E-02 27648 81.81818 %
 5.0000001E-02 - 0.1000000 0 0.0000000E+00 %
...
</code></pre>
</div>

<p>The first line means that you have 27,648 elements with a skewness value between 0 and 0.05 (which means the element is basically not skewed, just plain regular hexahedral element). The total number of elements you have in this mesh is (see in the <code class="highlighter-rouge">output_mesher.txt</code> file a bit further down):</p>

<div class="highlighter-rouge"><pre class="highlight"><code>...
 total number of elements in entire mesh: 33792
...
</code></pre>
</div>

<p>which gives you that: 27,648 / 33,792 (\sim) 81.8 % of all elements are not skewed, i.e. regular elements. a fantastic value :)</p>

<p>The histogram lists for this mesh also some stronger skewed elements, for example the worst ones belong to:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>...
 0.6000000 - 0.6500000 2048 6.060606 %
...
</code></pre>
</div>

<p>about 6 % of all elements have distortions with a skewness value between 0.6 and 0.65. The skewness values give you a hint of how good your mesh is. In an ideal world, you would want to have no distortions, just like the 81% from above. Those elements give you the best approximate values by the GLL quadrature used in the spectral-element method. However, having weakly distorted elements is still fine and the solutions are still accurate enough. So empirically, values up to around 0.7 are tolerable, above that you should consider remeshing…</p>

<p>To give you an idea why some of the elements are distorted, see the following figure [fig:mesh.vp] of the mesh you obtain in the example <code class="highlighter-rouge">EXAMPLES/meshfem3D_examples/simple_model/</code>.</p>

<p><img src="figures/mesh_vp.jpg" alt="Paraview visualization using the mesh vtk-files for the example given in `EXAMPLES/meshfem3D_examples/simple_model/`.&lt;span data-label=&quot;fig:mesh.vp&quot;&gt;&lt;/span&gt;" /></p>
<div class="figcaption" style="text-align:justify;font-size:80%"><span style="color:#9A9A9A">Figure: Paraview visualization using the mesh vtk-files for the example given in `EXAMPLES/meshfem3D_examples/simple_model/`.<span data-label="fig:mesh.vp"></span></span></div>

<p>You will see that the mesh contains a doubling layer, where we stitch elements together such that the size of two elements will transition to the size of one element (very useful to keep the ratio of wavespeed / element_size about constant). Those elements in this doubling layer have higher skewness values and make up those 6 % in the histogram.</p>

<p><span>the code gives following error message “need at least one receiver”:</span><br />
This means that no stations given in the input file <code class="highlighter-rouge">DATA/STATIONS</code> could be located within the dimensions of the mesh. This can happen for example when the mesh was created with the in-house mesher <code class="highlighter-rouge">xmeshfem3D</code> while using the Universal Transverse Mercator (UTM) projection but the simulation with <code class="highlighter-rouge">xspecfem3D</code> was suppressing this projection from latitude/longitude to x/y/z coordinates.</p>

<p>In such cases, try to change your <code class="highlighter-rouge">DATA/Par_file</code> and set e.g.:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>SUPPRESS_UTM_PROJECTION = .false.
</code></pre>
</div>

<p>to be the same in <code class="highlighter-rouge">Mesh_Par_file</code> and <code class="highlighter-rouge">Par_file</code>. This flag should be identical when using the in-house mesher <code class="highlighter-rouge">xmeshfem3D</code>, <code class="highlighter-rouge">xgenerate_databases</code> and <code class="highlighter-rouge">xspecfem3D</code> together to run simulations.</p>

<p>The flag determines if the coordinates you specify for your source and station locations are given as lat/lon degrees and must be converted to UTM coordinates. As an example, if you use <code class="highlighter-rouge">.false.</code> within <code class="highlighter-rouge">Mesh_Par_file</code> then you create a mesh with <code class="highlighter-rouge">xmeshfem3D</code> using the UTM projection from lat/lon as input format to UTM projected coordinates to store the mesh point positions, which is fine. The error then may occur if in the <code class="highlighter-rouge">Par_file</code> you have this set to <code class="highlighter-rouge">.true.</code> so that the <code class="highlighter-rouge">xgenerate_databases</code> and <code class="highlighter-rouge">xspecfem3D</code> suppress the UTM projection and assume that all coordinates you use now for source and receiver locations are given in meters (that is, converted) already. So it won’t find the specified locations in the used mesh. As a solutions, just change the flag in <code class="highlighter-rouge">Par_file</code> to be the same as in <code class="highlighter-rouge">Mesh_Par_file</code> and rerun <code class="highlighter-rouge">xgenerate_databases</code> and <code class="highlighter-rouge">xspecfem3D</code> to make sure that your simulation works fine.</p>

<p><span>I get the following error message “forward simulation became unstable and blew up”:</span><br />
In most cases this means that your time step size <code class="highlighter-rouge">DT</code> is chosen too big. Look at your files <code class="highlighter-rouge">output_mesher.txt</code> or <code class="highlighter-rouge">output_solver.txt</code> created in the folder <code class="highlighter-rouge">OUTPUT_FILES</code>. In these output files, find the section:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>...
 *********************************************
 *** Verification of simulation parameters ***
 *********************************************
...
 *** Minimum period resolved = 4.308774
 *** Maximum suggested time step = 6.8863556E-02
...
</code></pre>
</div>

<p>then change <code class="highlighter-rouge">DT</code> in the <code class="highlighter-rouge">DATA/Par_file</code> to be somewhere close to the maximum suggested time step. In the example above:
<code class="highlighter-rouge">DT = 0.05d0</code>
would (most probably) work fine. It could be also bigger than the 0.068 s suggested. This depends a bit on the distortions of your mesh elements. The more regular they are, the bigger you can choose <code class="highlighter-rouge">DT</code>. Just play with this value a bit and see when the simulation becomes stable …</p>

<hr />
<blockquote>
  <p>This documentation has been automatically generated by <a href="http://www.pandoc.org">pandoc</a>
based on the User manual (LaTeX version) in folder doc/USER_MANUAL/
(Mar 10, 2020)</p>
</blockquote>


    </section>

    <section class="page-footer">
      <footer class="site-footer">
        
          <span class="site-footer-owner"><a href="http://github.com/danielpeter/specfem3d">specfem3d</a> is maintained by <a href="http://github.com/danielpeter">danielpeter</a></span>
        
        <span class="site-footer-credits">generated by <a href="https://pages.github.com">GitHub Pages</a></span>
      </footer>
    </section>

    
  </body>
</html>
